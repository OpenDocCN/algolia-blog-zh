<html>
<head>
<title>Simplifying Parcel Delivery at Algolia - Algolia Blog | Algolia Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化Algolia的包裹递送- Algolia博客</h1>
<blockquote>原文：<a href="https://www.algolia.com/blog/engineering/simplifying-parcel-delivery-algolia/#0001-01-01">https://www.algolia.com/blog/engineering/simplifying-parcel-delivery-algolia/#0001-01-01</a></blockquote><div><div class="css-t54cg4"><blockquote><p class="translated"><em> <span>注意:我们对这篇文章和我们的包装标签读取OCR应用程序进行了重大更新。请查看关于<a href="https://www.algolia.com/blog/engineering/integrate-ocr-into-search-in-a-package-label-scanning-app/">如何将OCR集成到搜索</a> </span> <span>的新文章。</span> </em></p></blockquote>
<p class="translated">每天，Algolia的员工都会在巴黎办公室收到大量包裹。到目前为止，我们的办公室协调员久美子一直在照顾他们。每次有新包裹到达，久美子都要搜索标签，找出是给谁的，然后找到Slack上的人，让他们知道他们的包裹在前台等着。</p>
<p class="translated"><img loading="lazy" class="size-full wp-image-8532 aligncenter" src="../Images/f3552769c8e1324860a0e32a8479240e.png" alt="" srcset="https://blog-api.algolia.com/wp-content/uploads/2019/05/slack.png 880w, https://blog-api.algolia.com/wp-content/uploads/2019/05/slack-320x88.png 320w, https://blog-api.algolia.com/wp-content/uploads/2019/05/slack-768x211.png 768w, https://blog-api.algolia.com/wp-content/uploads/2019/05/slack-720x198.png 720w" sizes="(max-width: 880px) 100vw, 880px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2019/05/slack.png"/></p>
<p class="translated">这种手工流程很有效，但Algolia正在快速发展:仅在去年，巴黎办事处的员工人数就增加了一倍多。Kumiko开始用越来越多的时间手工处理包裹派送。在节日期间，它变得非常难以控制。</p>
<figure id="attachment_8533" aria-describedby="caption-attachment-8533" class="wp-caption aligncenter"><img loading="lazy" class="wp-image-8533 size-full" src="../Images/4909e2370b3a60fe5e52b6fa794850d4.png" alt="" srcset="https://blog-api.algolia.com/wp-content/uploads/2019/05/christmas-small.png 900w, https://blog-api.algolia.com/wp-content/uploads/2019/05/christmas-small-237x178.png 237w, https://blog-api.algolia.com/wp-content/uploads/2019/05/christmas-small-768x576.png 768w, https://blog-api.algolia.com/wp-content/uploads/2019/05/christmas-small-533x400.png 533w" sizes="(max-width: 900px) 100vw, 900px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2019/05/christmas-small.png"/><figcaption id="caption-attachment-8533" class="wp-caption-text">A typical day at Algolia, a month before Christmas</figcaption></figure>
<p class="translated">显然，手动操作无法扩展。</p>
<p class="translated">我在Algolia的内部工具小组工作。我们的使命是通过自动化低效的流程、制造工具和提供技术支持来提高Algolia团队的效率。我认为应该有一种<b>更快、更容易、可扩展的方式来帮助派送包裹。</b></p>
<p class="translated">我决定为它构建一个web应用程序。我的目标是尽可能地自动化这个过程，从扫描标签到通知人们有空闲时间。</p>
<h1 class="translated"><a id="first-attempt-the-barcode" class="anchor" href="#first-attempt-the-barcode" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第一次尝试:条形码</h1>
<p class="translated">我的第一个想法是使用标签上的条形码。我想我可以从中提取出雇员的姓和名。然而，我很快发现条形码不包含与二维码相同的数据。大多数时候，它们只包含<a href="https://en.wikipedia.org/wiki/International_Article_Number" target="_blank" rel="noopener noreferrer"> EAN </a>标识符。这些号码旨在查询私人承运商API以获取包裹的详细信息。</p>
<h1 class="translated"><a id="second-attempt-the-ocr" class="anchor" href="#second-attempt-the-ocr" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第二次尝试:OCR</h1>
<p class="translated">我们为每位Algolia员工编制了一份Algolia索引，用于我们的<a href="https://www.algolia.com/about/" target="_blank" rel="noopener noreferrer">关于页面</a>。我认为这可能是一个有趣的起点。想法是用光学字符识别引擎(<a href="https://en.wikipedia.org/wiki/Optical_character_recognition" target="_blank" rel="noopener noreferrer"> OCR </a>)来“读取”包裹标签，并将其与索引中的正确记录进行匹配。</p>
<h2 class="translated"><a id="step-1-read-the-package-label" class="anchor" href="#step-1-read-the-package-label" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第一步:阅读包装标签</h2>
<p class="translated">有几个处理OCR部分的开源库。最受欢迎的是<a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener noreferrer">宇宙魔方</a>。然而，在能够要求Tesseract识别字符(去饱和、对比度、去倾斜等)之前，您通常需要对图像执行<a href="https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality" target="_blank" rel="noopener noreferrer">一些预处理。)还有，我们收到的一些包裹标签是手写的！宇宙魔方不擅长阅读手写文字，预处理部分工作量很大。因此，我认为这个解决方案是行不通的。</a></p>
<p class="translated">我知道谷歌的<a href="https://cloud.google.com/vision/" target="_blank" rel="noopener noreferrer">视觉API </a>，它提供OCR功能，我想尝试一下，所以我决定试一试。除其他外，它规定:</p>
<ul>
<li class="translated">每月1，000次免费API调用(起步绰绰有余)。</li>
<li class="translated">手写字符检测(测试版)。</li>
</ul>
<p class="translated">我创建了一个React应用程序，并安装了<a href="https://www.npmjs.com/package/react-webcam" target="_blank" rel="noopener noreferrer"> React网络摄像头</a>组件来访问设备的摄像头。在内部，这个React组件利用了<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer"> getUserMedia </a> API。</p>
<p class="translated">一旦用户用手机捕捉到一个标签，应用程序会将其发送到快递后端。这负责将base64编码的图像代理到Google Vision API。然后，Vision返回一个JSON有效负载，其中包含文本形式的数据。</p>
<h2 class="translated"><a id="step-2-searching-with-algolia" class="anchor" href="#step-2-searching-with-algolia" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第二步:用Algolia搜索</h2>
<p class="translated">标签不好看。它们包含许多噪音。相关信息放在某个地方，被其他数据包围着:只与送货人相关的字符、标签号、发件人地址等。此外，顺序不一致，信息也不总是完整的，所以在发送给Algolia之前，我们不能依靠单词排序或元素位置来提取相关部分。</p>
<p class="translated">显然，我不想为我们的办公室经理选择正确的部件增加额外的手动步骤。这将是很麻烦的，并挫败了应用程序的整个目的。</p>
<p class="translated">好在<b>Algolia搜索API有一个有趣的参数</b> : <a href="https://www.algolia.com/doc/api-reference/api-parameters/removeWordsIfNoResults/" target="_blank" rel="noopener noreferrer"> <code>removeWordsIfNoResults</code> </a>。</p>
<p class="translated">当您将此参数设置为<code>allOptional</code>并且引擎未能找到原始查询的任何结果时，它会进行第二次尝试，同时将所有单词视为可选。这相当于将单词之间隐含的<code>AND</code>运算符转换为<code>OR</code>。</p>
<p class="translated">通常，当查询过于严格时，这个参数有助于<a href="https://www.algolia.com/doc/guides/managing-results/optimize-search-results/empty-or-insufficient-results/in-depth/why-use-remove-words-if-no-results/" target="_blank" rel="noopener noreferrer">改善结果</a>。在我的例子中，它允许我发送未经处理的提取数据；我相信Algolia引擎会“忽略”查询中无关的单词，只考虑重要的单词。</p>
<p class="translated">只剩下几个步骤:从Algolia搜索结果列表中提取第一个匹配项，并显示出来。从那里，我们的办公室经理可以确认结果，并自动向正确的员工发送Slack消息。</p>
<p class="translated"><img loading="lazy" class="size-full wp-image-8535 aligncenter" src="../Images/40e202e621b015509de39819d52755a7.png" alt="" srcset="https://blog-api.algolia.com/wp-content/uploads/2019/05/diagram-algo-package.jpg 1920w, https://blog-api.algolia.com/wp-content/uploads/2019/05/diagram-algo-package-320x101.jpg 320w, https://blog-api.algolia.com/wp-content/uploads/2019/05/diagram-algo-package-768x243.jpg 768w, https://blog-api.algolia.com/wp-content/uploads/2019/05/diagram-algo-package-720x228.jpg 720w" sizes="(max-width: 1920px) 100vw, 1920px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2019/05/diagram-algo-package.jpg"/></p>
<p class="translated">当Kumiko拍摄包装标签的照片时，该应用程序会通过Express后端将其发送到Google Vision。Google Vision返回一个包含已识别文本的JSON有效负载，后端将其作为搜索查询发送给Algolia，并附带<code>removeWordsIfNoResults</code>选项。Algolia返回匹配记录的列表，后端从中提取第一个匹配记录，并将其返回给React应用程序。这使得Kumiko只需轻轻一点就可以直接放松这个人。</p>
<p class="translated"><iframe class="aligncenter" src="https://www.youtube.com/embed/gM0siS-4h0g" frameborder="0" allowfullscreen="allowfullscreen">视频</iframe></p>
<p class="translated">Algolia是一个强大的搜索引擎，但是搜索并不局限于搜索框。只要有一点想象力，您就可以将Algolia的使用远远超出盒子的范围，并解决各种问题。</p>
<p class="translated">这得益于Algolia强大的文化。这个项目源于Algolia的核心价值观之一:关爱。我们尽量互相帮助。我是在Algolia的每月工程冲刺时做的，这让员工可以进行实验！</p>
</div></div>    
</body>
</html>