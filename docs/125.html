<html>
<head>
<title>Algolia + MongoDB – Part 4: Frontend implementation and conclusion | Algolia Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Algolia+MongoDB–第4部分:前端实现和结论</h1>
<blockquote>原文：<a href="https://www.algolia.com/blog/engineering/supercharging-search-for-ecommerce-solutions-with-algolia-and-mongodb-frontend-implementation-and-conclusion/#0001-01-01">https://www.algolia.com/blog/engineering/supercharging-search-for-ecommerce-solutions-with-algolia-and-mongodb-frontend-implementation-and-conclusion/#0001-01-01</a></blockquote><div><div class="css-t54cg4"><p class="translated">我们邀请Starschema的朋友写一个结合使用Algolia和MongoDB的例子。我们希望您喜欢这个由全栈工程师Soma Osvay撰写的四部分系列。</p>
<p class="translated">如果你想回顾一下，以下是其他链接:</p>
<p class="translated"><a href="https://www.algolia.com/blog/engineering/supercharging-search-for-ecommerce-solutions-with-algolia-and-mongodb-use-case-architecture-and-current-challenges/">第1部分——用例、架构和当前挑战</a></p>
<p class="translated"><a href="https://www.algolia.com/blog/engineering/supercharging-search-for-ecommerce-solutions-with-algolia-and-mongodb-proposed-solution-and-design/">第2部分–建议的解决方案和设计</a></p>
<p class="translated"><a href="https://www.algolia.com/blog/engineering/supercharging-search-for-ecommerce-solutions-with-algolia-and-mongodb-data-pipeline-implementation/">第3部分–数据管道实施</a></p>
<hr/>
<p class="translated">在这篇文章中，我将实现使用我们在本系列第3部分中创建的Algolia索引的前端。创建的web应用程序在这里可用:<a href="https://algolia-listings.starschema.com/">https://algolia-listings.starschema.com/</a>。默认情况下，您可以使用我们的示例数据来尝试它，但是如果您一直遵循并尝试我们在上一篇文章中使用的格式，您可以连接自己的索引！应用程序的代码可在GitHub的 <a href="https://github.com/algolia-samples/algolia-mongodb">上</a><a href="https://stackblitz.com/github/serionist/algolia-mongodb-frontend/tree/master?file=src%2Falgolia.js">获得。在</a><a href="https://stackblitz.com/github/algolia-samples/algolia-mongodb/tree/main/search-web-application?file=src%2Falgolia.js"> StackBlitz </a>上举办了一场公开演示。</p>
<h2 class="translated"><a id="step-0-planning" class="anchor" href="#step-0-planning" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第0步。规划</h2>
<p class="translated">我们现有的面向消费者的应用程序的前端是用jQuery和普通JavaScript编写的，所以我需要确保我正在开发的Algolia示例应用程序与这些技术兼容。幸运的是，Algolia的<a href="https://www.algolia.com/doc/guides/building-search-ui/what-is-instantsearch/js/"> InstantSearch.js </a>无需任何定制就可以与vanilla前端兼容，所以我可以使用Algolia文档中的默认示例实现。在开始之前，我画了一个我想用Algolia搜索UI创建的快速草图。我将我们现有的搜索页面作为基线，并添加了一些我们目前缺少的额外功能:</p>
<p class="translated"><img loading="lazy" class="alignnone size-full wp-image-15602" src="../Images/9a9ae6de4f88b1206d376009f7a1e04e.png" alt="Frontend wireframe design" srcset="https://blog-api.algolia.com/wp-content/uploads/2022/07/frontend-wireframe-mongodb-algolia-series.png 1511w, https://blog-api.algolia.com/wp-content/uploads/2022/07/frontend-wireframe-mongodb-algolia-series-168x178.png 168w, https://blog-api.algolia.com/wp-content/uploads/2022/07/frontend-wireframe-mongodb-algolia-series-378x400.png 378w, https://blog-api.algolia.com/wp-content/uploads/2022/07/frontend-wireframe-mongodb-algolia-series-768x813.png 768w, https://blog-api.algolia.com/wp-content/uploads/2022/07/frontend-wireframe-mongodb-algolia-series-1451x1536.png 1451w" sizes="(max-width: 1511px) 100vw, 1511px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2022/07/frontend-wireframe-mongodb-algolia-series.png"/></p>
<p class="translated">我使用官方的Algolia <a href="https://www.algolia.com/doc/guides/building-search-ui/getting-started/js/">入门指南</a>来设置我的项目并开始编码。<a href="https://www.algolia.com/blog/engineering/journey-better-dx-create-instantsearch-app/"> <code>npx create-instantsearch-app</code>创建了一个准备充分、结构良好的应用程序</a>，我可以修改它来匹配我的用例。</p>
<p class="translated">在开始Algolia特定的开发之前，我必须确保我的Algolia应用程序ID和API密钥没有硬编码在我的应用程序中，以便我可以轻松地共享源代码。为此，我们创建了一个表单，要求您提供Algolia凭据，并将它们存储在浏览器<code>localStorage</code>中，以便在查询中使用。</p>
<p class="translated"><img loading="lazy" class="alignnone size-full wp-image-15604" src="../Images/03829ad31da68507546e577f7fac3e8b.png" alt="Demo application screenshot" srcset="https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-screenshot-mongodb-algolia-series.png 542w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-screenshot-mongodb-algolia-series-210x178.png 210w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-screenshot-mongodb-algolia-series-471x400.png 471w" sizes="(max-width: 542px) 100vw, 542px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-screenshot-mongodb-algolia-series.png"/></p>
<h2 class="translated"><a id="step-1-modify-html-and-css" class="anchor" href="#step-1-modify-html-and-css" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第一步。修改HTML和CSS</h2>
<p class="translated">首先，我必须改变与项目一起创建的生成的<code>index.html</code>文件的布局。这是因为我希望有一个不同于Algolia最初根据我的UI计划为我创建的搜索布局。经过几次迭代，我实际上偏离了我最初的计划:我在过滤器部分的顶部添加了一个Clear Refinements按钮，取消了分页，因为我意识到Algolia支持<a href="https://www.algolia.com/doc/guides/building-search-ui/ui-and-ux-patterns/infinite-scroll/js/">无限滚动</a>，我决定实现<a href="https://www.algolia.com/doc/guides/building-search-ui/ui-and-ux-patterns/geo-search/js/"> GeoSearch </a>(这样我们的最终用户除了文本之外还可以通过位置进行搜索)。我更新的特定于Algolia的HTML和CSS如下所示:</p>
<pre><code class="language-html">&lt;!--Used to host the Algolia search UI--&gt;&#13;
&lt;div id="algolia-container"&gt;&#13;
	&lt;!-- The search box. Located on the top of the page, spanning the entire width --&gt;&#13;
	&lt;div id="searchbox"&gt;&lt;/div&gt;&#13;
	&lt;!-- The filters section, located on the left --&gt;&#13;
	&lt;div class="filters"&gt;&#13;
		&lt;h2&gt;Filters&lt;/h2&gt;&#13;
		&lt;!-- Clear filters button location --&gt;&#13;
		&lt;div id="clear-refinements"&gt;&lt;/div&gt;&#13;
		&lt;!-- Country filter location --&gt;&#13;
		&lt;h3&gt;Country&lt;/h3&gt;&#13;
		&lt;div id="country-list"&gt;&lt;/div&gt;&#13;
		&lt;!-- Property Types filter location --&gt;&#13;
		&lt;h3&gt;Property Types&lt;/h3&gt;&#13;
		&lt;div id="property-list"&gt;&lt;/div&gt;&#13;
		&lt;!-- Review scores filter location --&gt;&#13;
		&lt;h3&gt;Review Scores&lt;/h3&gt;&#13;
		&lt;div id="review-scores"&gt;&lt;/div&gt;&#13;
		&lt;!-- Price filter location --&gt;&#13;
		&lt;h3&gt;Price&lt;/h3&gt;&#13;
		&lt;div id="price"&gt;&lt;/div&gt;&#13;
		&lt;!-- Cleaning fee filter location --&gt;&#13;
		&lt;h3&gt;Cleaning Fee&lt;/h3&gt;&#13;
		&lt;div id="cleaning-fee"&gt;&lt;/div&gt;&#13;
	&lt;/div&gt;&#13;
	&lt;!-- The results panel, located to the right side from the filters --&gt;&#13;
	&lt;div class="results"&gt;&#13;
		&lt;h2&gt;Results&lt;/h2&gt;&#13;
		&lt;!-- The pagination container, which was later changed to infinite scroll results container --&gt;&#13;
		&lt;div class="pagination-container"&gt;&#13;
			&lt;!-- The container which displays the number of results, and a link which can load the next set of results. These are modified from js --&gt;&#13;
			&lt;div id="result-count"&gt;&#13;
				&lt;span&gt;&lt;/span&gt;&#13;
				&lt;a href="#"&gt;&lt;/a&gt;&#13;
			&lt;/div&gt;&#13;
			&lt;!-- The location of the control that controls how many results are loaded at once --&gt;&#13;
			&lt;div id="per-page"&gt;&lt;/div&gt;&#13;
		&lt;/div&gt;&#13;
		&lt;!-- The location for the map which shows the results on the world map --&gt;&#13;
		&lt;div id="map-display"&gt;&#13;
			&lt;h3&gt;Map&lt;/h3&gt;&#13;
			&lt;div id="geo-search"&gt;&lt;/div&gt;&#13;
		&lt;/div&gt;&#13;
		&lt;!-- The location of the search result details --&gt;&#13;
		&lt;div id="details-display"&gt;&#13;
			&lt;h3&gt;Details&lt;/h3&gt;&#13;
			&lt;div id="hits"&gt;&lt;/div&gt;&#13;
		&lt;/div&gt;&#13;
	&lt;/div&gt;&#13;
&lt;/div&gt;&#13;
</code></pre>
<p class="translated">Algolia的InstantSearch.js能够自动创建自己的控件，所以我只需提供布局本身。</p>
<p class="translated">我还用了一些CSS来使它看起来更好:</p>
<pre><code class="language-css">#algolia-container {&#13;
    max-width: 1200px;&#13;
    margin: 0 auto;&#13;
    padding: 1rem;&#13;
    display: grid;&#13;
    grid-template-columns: 200px 1fr;&#13;
    grid-template-rows: auto auto;&#13;
    gap: 20px;&#13;
}&#13;
 &#13;
#searchbox {&#13;
    grid-column: 1 / 3;&#13;
    grid-row: 1;&#13;
}&#13;
.filters {&#13;
    grid-row: 2;&#13;
    grid-column: 1;&#13;
}&#13;
.results {&#13;
    grid-row: 2;&#13;
    grid-column: 2;&#13;
}&#13;
.pagination-container {&#13;
    display: grid;&#13;
    grid-template-columns: 1fr auto auto;&#13;
    gap: 20px;&#13;
}&#13;
 &#13;
.ais-GeoSearch-map {&#13;
    height: 500px; /* You can change this height */&#13;
}&#13;
</code></pre>
<h2 class="translated"><a id="step-2-initialize-algolia-instantsearch-js" class="anchor" href="#step-2-initialize-algolia-instantsearch-js" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第二步。初始化Algolia即时搜索. js</h2>
<p class="translated">接下来，我初始化了Algolia JS引擎，它将查询我的索引并显示结果。</p>
<pre><code class="language-jsx">const {&#13;
	algoliasearch,&#13;
	instantsearch&#13;
} = window;&#13;
&#13;
// Initialize the Algolia Search client and connect to our index&#13;
const searchClient = algoliasearch(appId, searchKey);&#13;
const search = instantsearch({&#13;
	indexName: indexName,&#13;
	routing: true,&#13;
	searchClient,&#13;
});&#13;
</code></pre>
<h2 class="translated"><a id="step-3-add-widgets" class="anchor" href="#step-3-add-widgets" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第三步。添加小部件</h2>
<p class="translated">Algolia已经将他们的前端功能设计成了“widgets”，即你可以动态合并空的HTML节点的UI组件。Algolia使用这些来添加搜索框、过滤和分面界面、无限滚动和许多其他功能。我们可以通过调用<code>addWidgets</code>来添加小部件，并以数组的形式提供所需的小部件。</p>
<pre><code class="language-jsx">search.addWidgets([&#13;
	// The widget definitions go here&#13;
]);&#13;
</code></pre>
<p class="translated">我将逐步介绍我使用的所有小部件，但是请记住，下面的代码示例都发生在<code>addWidgets</code>的数组参数中。</p>
<ol>
<li class="translated"><a href="https://www.algolia.com/doc/api-reference/widgets/search-box/js/">搜索框</a>。这将向页面添加基本搜索栏。<pre><code class="language-jsx">instantsearch.widgets.searchBox({&#13; 	container: '#searchbox',&#13; 	placeholder: 'Search real-estate listings',&#13; 	autofocus: true&#13; })&#13; </code></pre></li>
<li><a href="https://www.algolia.com/doc/api-reference/widgets/infinite-hits/js/">InfiniteHits</a>. This is where our search results will populate. I used <code>InfiniteHits</code> instead of just <code>Hits</code> to enable infinite scrolling.
<pre><code class="language-jsx">instantsearch.widgets.infiniteHits({&#13;
	container: '#hits',&#13;
	templates: {&#13;
		// Item template will be filled out later&#13;
		item: `Sample item template`&#13;
	}&#13;
})&#13;
</code></pre>
<p class="translated">该控件将包含item模板，这是一段显示单个搜索结果的HTML代码。我会回到这个问题上——现在这里只有一个占位符。</p></li>
<li class="translated"><a href="https://www.algolia.com/doc/api-reference/widgets/hits-per-page/js/">每页点击量</a>。这个小部件允许用户选择一次加载的项目数量。<pre><code class="language-jsx">instantsearch.widgets.hitsPerPage({&#13; 	container: '#per-page',&#13; 	items: [{&#13; 			label: 'Load 5 results per page',&#13; 			value: 5&#13; 		},&#13; 		{&#13; 			label: 'Load 10 results per page',&#13; 			value: 10&#13; 		},&#13; 		{&#13; 			label: 'Load 20 results per page',&#13; 			value: 20&#13; 		},&#13; 		{&#13; 			label: 'Load 50 results per page',&#13; 			value: 50,&#13; 			default: true&#13; 		},&#13; 		{&#13; 			label: 'Load 100 results per page',&#13; 			value: 100&#13; 		},&#13; 		{&#13; 			label: 'Load 200 results per page',&#13; 			value: 200&#13; 		}&#13; 	]&#13; })&#13; </code></pre></li>
<li class="translated"><a href="https://www.algolia.com/doc/api-reference/widgets/clear-refinements/js/">清除滤镜</a>按钮。用户可以按下此按钮清除所有优化。<pre><code class="language-jsx">instantsearch.widgets.clearRefinements({&#13; 	container: '#clear-refinements',&#13; 	templates: {&#13; 		resetLabel: 'Clear filters',&#13; 	},&#13; })&#13; </code></pre></li>
<li class="translated">针对酒店类型和国家过滤器的<a href="https://www.algolia.com/doc/api-reference/widgets/refinement-list/js/">细化列表</a>。这提供了复选框，允许用户过滤特定属性类型和位于特定国家/地区的结果。<pre><code class="language-jsx">instantsearch.widgets.refinementList({&#13;   container: '#property-list',&#13;   attribute: 'property_type'&#13; }),&#13; instantsearch.widgets.refinementList({&#13;   container: '#country-list',&#13;   attribute: 'address.country'&#13; })&#13; </code></pre></li>
<li class="translated">一个<a href="https://www.algolia.com/doc/api-reference/widgets/rating-menu/js/">分级菜单</a>，用于过滤某些分级的列表。我原本想为此创建一个简单的单选按钮菜单，但我意识到Algolia支持这种开箱即用的控件。<pre><code class="language-jsx">instantsearch.widgets.ratingMenu({&#13; 	container: '#review-scores',&#13; 	attribute: 'scores.stars'&#13; })&#13; </code></pre></li>
<li class="translated"><a href="https://www.algolia.com/doc/api-reference/widgets/range-slider/js/">列表价格和清洁费的范围滑块</a>。最初，我想将文本输入限制在某个范围内，但是我发现滑块使用起来更直观。<pre><code class="language-jsx">instantsearch.widgets.rangeSlider({&#13; 	container: '#price',&#13; 	attribute: 'price',&#13; 	precision: 10&#13; }),&#13; instantsearch.widgets.rangeSlider({&#13; 	container: '#cleaning-fee',&#13; 	attribute: 'cleaning_fee',&#13; 	precision: 5&#13; })&#13; </code></pre></li>
<li class="translated"><a href="https://www.algolia.com/doc/api-reference/widgets/geo-search/js/+">地图小工具</a>用于在世界地图上显示结果。我还为地图上的标记添加了一个click事件，稍后我将实现该事件来滚动到被单击的列表的详细信息。<pre><code class="language-jsx">instantsearch.widgets.geoSearch({&#13; 	container: '#geo-search',&#13; 	googleReference: window.google,&#13; 	initialPosition: {&#13; 		lat: 48.864716,&#13; 		lng: 2.349014,&#13; 	},&#13; 	initialZoom: 10,&#13; 	builtInMarker: {&#13; 		createOptions(item) {&#13; 			return {&#13; 				title: item.name,&#13; 			};&#13; 		},&#13; 		events: {&#13; 			click({&#13; 				event,&#13; 				item,&#13; 				marker,&#13; 				map&#13; 			}) {&#13; 				// to be implemented later&#13; 			},&#13; 		},&#13; 	},&#13; })&#13; </code></pre></li>
<li>I also added a custom connector for <a href="https://www.algolia.com/doc/api-reference/widgets/infinite-hits/js/#full-example">infinite hits</a>. Custom connectors let you hijack the functionality of a widget but provide your own HTML, so it’s entirely customizable and dynamic. The reason that I went this route is that Algolia didn’t provide an existing widget to show the result information exactly the way I wanted to due to the layout of our existing search page. Essentially, I give the array of widgets my own custom widget name like this:
<pre><code class="language-jsx">customInfiniteHits({})&#13;
</code></pre>
<p class="translated">然后，在小部件数组之外，我创建了一个自定义函数，当点击次数发生变化时运行该函数，并为点击列表返回新的HTML。我将它配置为在当前地理搜索没有搜索结果或根本没有搜索结果时拥有定制的视图。当有结果时，它显示结果计数，并允许用户请求将下一页结果附加到当前页的底部。</p>
<pre><code class="language-jsx">// Define custom logic that runs when the results changed.&#13;
// This will call a function that displays the total result count and allows the user to Load more or clear filters if needed.&#13;
// The hitsChanged method is defined below to keep the initialization code clean.&#13;
// Documentation: &lt;https://www.algolia.com/doc/api-reference/widgets/infinite-hits/js/&gt;&#13;
const renderInfiniteHits = hitsChanged;&#13;
const customInfiniteHits = instantsearch.connectors.connectInfiniteHits(&#13;
	renderInfiniteHits&#13;
);&#13;
// This function is called every time the search results change&#13;
// It checks how many results there are in total and either:&#13;
// - displays a 'No results found' message to the user along with the possibility to Clear Filters. It also hides the result container and possibly the map too&#13;
// - displays information about how many total results there are, and how many are currently displayed. It also allows the users to click a 'Load more' button on the top of the page.&#13;
function hitsChanged(renderOptions) {&#13;
	// if this is an initial render and we got no results object, skip&#13;
	if (!renderOptions.results) {&#13;
		return;&#13;
	}&#13;
	// get the reference for the Result Count elements on the UI (its text and link as well)&#13;
	const resultCountElement = document.getElementById('result-count');&#13;
	const textEl = resultCountElement.querySelector('span');&#13;
	const linkEl = resultCountElement.querySelector('a');&#13;
	// check if we have any results&#13;
	const hasHits = renderOptions.results.nbHits !== 0;&#13;
	// check if we have any search query&#13;
	const hasQuery = !!renderOptions.results.query;&#13;
	// check if we have any geo bounding box (query made on map)&#13;
	const hasGeoQuery = !!renderOptions.results._state.insideBoundingBox;&#13;
	// We show/hide result Details depending if we have results or not&#13;
	document.getElementById('details-display').style.display = hasHits ? 'block' : 'none';&#13;
	// We hide the Map display if we have no results AND there was no map query applied (so the query can be undone)&#13;
	document.getElementById('map-display').style.display = hasHits || hasGeoQuery ? 'block' : 'none';&#13;
	// Update the Result count container to display information about results&#13;
	if (hasHits) {&#13;
		// if there are any results&#13;
		if (renderOptions.isLastPage) {&#13;
			// if we are on last page, show text and a link to clear filters&#13;
			textEl.innerText = `Showing all ${renderOptions.hits.length} results`;&#13;
			linkEl.style.display = 'none';&#13;
			linkEl.innerText = 'Clear all filters';&#13;
			linkEl.href = '.';&#13;
			linkEl.style.display = 'inline';&#13;
			linkEl.onclick = null;&#13;
		} else {&#13;
			// if we are not on last page, show text and link to load more items&#13;
			textEl.innerText = `Showing top ${renderOptions.hits.length} results of ${renderOptions.results.nbHits}`;&#13;
			linkEl.href = '';&#13;
			linkEl.innerText = 'Load more';&#13;
			linkEl.style.display = 'inline';&#13;
			linkEl.href = "#";&#13;
			linkEl.onclick = () =&gt; {&#13;
				renderOptions.showMore();&#13;
				return false;&#13;
			};&#13;
		}&#13;
	} else {&#13;
		// if we have no results, construct message&#13;
		let statusMessage = 'No results have been found';&#13;
		if (hasQuery) {&#13;
			statusMessage += ` for '${renderOptions.results.query}'`;&#13;
		}&#13;
		if (hasGeoQuery) {&#13;
			statusMessage += ' in selected map area';&#13;
		}&#13;
		// show message and link to clear filters&#13;
		textEl.innerText = statusMessage&#13;
		linkEl.innerText = 'Clear all filters';&#13;
		linkEl.href = '.';&#13;
		linkEl.style.display = 'inline';&#13;
		linkEl.onclick = null;&#13;
	}&#13;
}&#13;
</code></pre>
</li>
</ol>
<p class="translated">添加我的小部件后，UI如下所示:</p>
<p class="translated"><img loading="lazy" class="alignnone size-full wp-image-15606" src="../Images/7ec9b75eb884f09a1d0fd5ae1d1448bc.png" alt="Demo application UI with new widgets" srcset="https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-widgets-mongodb-algolia-series.png 938w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-widgets-mongodb-algolia-series-196x178.png 196w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-widgets-mongodb-algolia-series-441x400.png 441w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-widgets-mongodb-algolia-series-768x697.png 768w" sizes="(max-width: 938px) 100vw, 938px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-widgets-mongodb-algolia-series.png"/></p>
<h2 class="translated"><a id="step-4-modify-the-item-template" class="anchor" href="#step-4-modify-the-item-template" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>第四步。修改项目模板</h2>
<p class="translated">在添加小部件时，我将搜索结果模板留空，因此项目细节还没有正确显示。我将<code>InfiniteHits</code>小部件配置更改为:</p>
<pre><code class="language-jsx">instantsearch.widgets.infiniteHits({&#13;
  container: '#hits',&#13;
  templates: {&#13;
    // We use no 'empty' template, as our results container will be hidden if there are no results.&#13;
    // The item template is heavily modified to draw the details of a listing in detail&#13;
    item: `&#13;
      &lt;article id="hit-{{objectID}}"&gt;&#13;
        &lt;div class="name-container"&gt;&#13;
          &lt;h1 class="name"&gt;{{#helpers.highlight}}{ "attribute": "name" }{{/helpers.highlight}}&lt;/h1&gt;&#13;
          {{#scores}}&#13;
            &lt;div class="stars"&gt;&#13;
              &lt;svg aria-hidden="true"&gt;&#13;
                {{#scores.has_one}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starSymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_one}}&#13;
                {{^scores.has_one}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starEmptySymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_one}}&#13;
              &lt;/svg&gt;&#13;
              &lt;svg aria-hidden="true"&gt;&#13;
                {{#scores.has_two}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starSymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_two}}&#13;
                {{^scores.has_two}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starEmptySymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_two}}&#13;
              &lt;/svg&gt;&#13;
              &lt;svg aria-hidden="true"&gt;&#13;
                {{#scores.has_three}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starSymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_three}}&#13;
                {{^scores.has_three}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starEmptySymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_three}}&#13;
              &lt;/svg&gt;&#13;
              &lt;svg aria-hidden="true"&gt;&#13;
                {{#scores.has_four}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starSymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_four}}&#13;
                {{^scores.has_four}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starEmptySymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_four}}&#13;
              &lt;/svg&gt;&#13;
              &lt;svg aria-hidden="true"&gt;&#13;
                {{#scores.has_five}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starSymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_five}}&#13;
                {{^scores.has_five}}&#13;
                  &lt;use xlink:href="#ais-RatingMenu-starEmptySymbol"&gt;&lt;/use&gt;&#13;
                {{/scores.has_five}}&#13;
              &lt;/svg&gt;&#13;
            &lt;/div&gt;&#13;
          {{/scores}}&#13;
        &lt;/div&gt;&#13;
        {{#description}}&#13;
          &lt;div class="description"&gt;&#13;
            &lt;div class="title"&gt;Description{{}}&lt;/div&gt;&#13;
            &lt;p class="desc"&gt;{{#helpers.highlight}}{ "attribute": "description" }{{/helpers.highlight}}&lt;/p&gt;&#13;
          &lt;/div&gt;&#13;
        {{/description}}&#13;
        {{#summary}}&#13;
          &lt;div class="summary"&gt;&#13;
            &lt;div class="title"&gt;Summary&lt;/div&gt;&#13;
            &lt;p class="desc"&gt;{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}&lt;/p&gt;&#13;
          &lt;/div&gt;&#13;
        {{/summary}}&#13;
        {{#space}}&#13;
          &lt;div class="space"&gt;&#13;
            &lt;div class="title"&gt;Space&lt;/div&gt;&#13;
            &lt;p class="desc"&gt;{{#helpers.highlight}}{ "attribute": "space" }{{/helpers.highlight}}&lt;/p&gt;&#13;
          &lt;/div&gt;&#13;
        {{/space}}&#13;
        {{#neighborhood}}&#13;
          &lt;div class="neigh"&gt;&#13;
            &lt;div class="title"&gt;Neighborhood&lt;/div&gt;&#13;
            &lt;p class="desc"&gt;{{#helpers.highlight}}{ "attribute": "neighborhood_overview" }{{/helpers.highlight}}&lt;/p&gt;&#13;
          &lt;/div&gt;&#13;
        {{/neighborhood}}&#13;
        {{#transit}}&#13;
          &lt;div class="transit"&gt;&#13;
            &lt;div class="title"&gt;Transit&lt;/div&gt;&#13;
            &lt;p class="desc"&gt;{{#helpers.highlight}}{ "attribute": "transit" }{{/helpers.highlight}}&lt;/p&gt;&#13;
          &lt;/div&gt;&#13;
        {{/transit}}&#13;
        &lt;div class="info"&gt;&#13;
          {{#property_type}}&#13;
            &lt;div&gt;&#13;
              &lt;span class="title"&gt;Property Type:&lt;/span&gt;&#13;
              &lt;span&gt;{{property_type}}&lt;/span&gt;&#13;
            &lt;/div&gt;&#13;
          {{/property_type}}&#13;
          {{#address}}&#13;
            &lt;div&gt;&#13;
              &lt;span class="title"&gt;Address:&lt;/span&gt;&#13;
              &lt;span&gt;{{#helpers.highlight}}{ "attribute": "address.street" }{{/helpers.highlight}}&lt;/span&gt;&#13;
            &lt;/div&gt;&#13;
          {{/address}}&#13;
          {{#price}}&#13;
            &lt;div&gt;&#13;
              &lt;span class="title"&gt;Price:&lt;/span&gt;&#13;
              &lt;b&gt;{{price}}$ per night&lt;/b&gt;&#13;
              {{#cleaning_fee}}&#13;
                &lt;span&gt; + {{cleaning_fee}}$ cleaning fee&lt;/span&gt;&#13;
              {{/cleaning_fee}}&#13;
              {{#security_deposit}}&#13;
                &lt;span&gt; + {{security_deposit}}$ security deposit&lt;/span&gt;&#13;
              {{/security_deposit}}&#13;
            &lt;/div&gt;&#13;
          {{/price}}&#13;
          {{#accommodates}}&#13;
            &lt;div&gt;&#13;
              &lt;span class="title"&gt;Accommodates:&lt;/span&gt;&#13;
              &lt;b&gt;{{accommodates}} people&lt;/b&gt;&#13;
              {{#bedrooms}}&#13;
                &lt;span&gt; in {{bedrooms}} bedroom(s)&lt;/span&gt;&#13;
              {{/bedrooms}}&#13;
              {{#beds}}&#13;
                &lt;span&gt;, {{beds}} bed(s)&lt;/span&gt;&#13;
              {{/beds}}&#13;
              {{#bathrooms}}&#13;
                &lt;span&gt; with {{bathrooms}} bathroom(s)&lt;/span&gt;&#13;
              {{/bathrooms}}&#13;
            &lt;/div&gt;&#13;
          {{/accommodates}}&#13;
        &lt;/div&gt;&#13;
        {{#images.picture_url}}&#13;
          &lt;img class="image" src="{{images.picture_url}}"&gt;&#13;
        {{/images.picture_url}}&#13;
      &lt;/article&gt;&#13;
		`&#13;
  }&#13;
})&#13;
</code></pre>
<p class="translated">Algolia项目模板使用<a href="https://mustache.github.io/mustache.5.html"> Mustache </a>添加变量。在创建索引时将变量添加为<code>attributesToRetrieve</code>很重要，这样当Algolia构建项目的HTML时，它们就会出现在代码中。我还添加了以下CSS来正确显示项目:</p>
<pre><code class="language-css">article {&#13;
    display: grid;&#13;
    width: 100%;&#13;
    grid-template-columns: 1fr 400px;&#13;
    column-gap: 20px;&#13;
    grid-template-rows: auto auto auto auto auto auto auto 1fr;&#13;
}&#13;
 &#13;
article .title {&#13;
    margin-top: 8px;&#13;
    font-size: 14px;&#13;
    color: gray;&#13;
}&#13;
article p {&#13;
    display: block;&#13;
    margin: 0px;&#13;
}&#13;
 &#13;
article .name-container {&#13;
    grid-row: 1;&#13;
    grid-column: 1 / 3;&#13;
}&#13;
article .name-container &gt; * {&#13;
    display: inline-block;&#13;
    vertical-align: middle;&#13;
}&#13;
 &#13;
.stars {&#13;
    margin-left: 8px;&#13;
    height: 24px;&#13;
}&#13;
.stars svg {&#13;
    width: 24px;&#13;
    height: 24px;&#13;
    display: inline-block;&#13;
    fill: yellowgreen;&#13;
}&#13;
 &#13;
article .description {&#13;
    grid-row: 2;&#13;
    grid-column: 1;&#13;
}&#13;
article .summary {&#13;
    grid-row: 3;&#13;
    grid-column: 1;&#13;
}&#13;
article .space {&#13;
    grid-row: 4;&#13;
    grid-column: 1;&#13;
}&#13;
article .neigh {&#13;
    grid-row: 5;&#13;
    grid-column: 1;&#13;
}&#13;
article .transit {&#13;
    grid-row: 6;&#13;
    grid-column: 1;&#13;
}&#13;
article .info {&#13;
    grid-row: 7;&#13;
    grid-column: 1;&#13;
}&#13;
article .info &gt; * {&#13;
    margin-top: 8px;&#13;
}&#13;
article .image {&#13;
    grid-column: 2;&#13;
    grid-row: 2 / 9;&#13;
    margin-top: 8px;&#13;
    width: 100%;&#13;
}&#13;
article .properties {&#13;
    display: grid;&#13;
    grid-template-columns: auto auto;&#13;
    gap: 4px;&#13;
    grid-auto-flow: column;&#13;
    width: fit-content;&#13;
}&#13;
article .properties .key {&#13;
    color: gray;&#13;
    font-size: 12px;&#13;
}&#13;
article .properties .value {&#13;
    font-size: 12px;&#13;
}&#13;
</code></pre>
<p class="translated">现在搜索结果是这样的:</p>
<p class="translated"><img loading="lazy" class="alignnone size-full wp-image-15608" src="../Images/3f11acbe6c0783a58bc7e00e396682a3.png" alt="Demo application UI final search results" srcset="https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-search-results-mongodb-algolia-series.png 914w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-search-results-mongodb-algolia-series-241x178.png 241w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-search-results-mongodb-algolia-series-542x400.png 542w, https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-search-results-mongodb-algolia-series-768x567.png 768w" sizes="(max-width: 914px) 100vw, 914px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2022/07/demo-application-ui-search-results-mongodb-algolia-series.png"/></p>
<h2 class="translated"><a id="lessons-learned" class="anchor" href="#lessons-learned" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>吸取教训</h2>
<p class="translated">总的来说，我发现Algolia InstantSearch.js框架为在web应用程序中创建自己的搜索界面提供了一种非常灵活的方式。UI构建感觉很流畅，小部件系统是一个非常好的工具，可以非常快速地构建好看的界面。使用定制连接器，我还意识到Algolia也可以适应更复杂的用例，这需要更定制的方法。生成的HTML可以很容易地进行样式化，看起来与原型大不相同。</p>
<p class="translated">我的整个Algolia前端实现只有几百行代码，相比之下，如果我自己要实现这种功能，我必须编写数千行代码。大部分代码都被我的自定义泛化和连接器逻辑占用了，Algolia让我只用几个命令就将所有这些复杂的特性与默认的InstantSearch.js小部件捆绑在一起。</p>
<p class="translated">搜索速度惊人的快，指数超出我的预期相当多。平均搜索或过滤操作在60毫秒内显示结果，比我们通常预期的整整一秒钟要快得多。</p>
<p class="translated"><a class="aligncenter" href="https://www.algolia.com/developers/code-exchange/backend-tools/integrate-mongo-db-with-algolia/"> <img loading="lazy" class="wp-image-13777" src="../Images/7665551c18b687f25dcadc15cb213b7d.png" alt="" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2022/01/CodeX@2x.png"/> </a></p>
<h2 class="translated"><a id="overall-conclusion" class="anchor" href="#overall-conclusion" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a>总体结论</h2>
<p class="translated">在概念验证过程中，我发现:</p>
<ul>
<li class="translated">Algolia的搜索速度和准确性超过了我迄今为止见过的任何现有的解决方案。</li>
<li class="translated">Algolia索引结构简单，不需要深入的技术知识。</li>
<li class="translated">搜索优先级、排名、地理搜索和其他属性都是可定制的，不需要大量的维护。</li>
<li class="translated">Algolia搜索索引无缝集成到我们现有的数据管道中。它还公开了一个很棒的Python API，因此脚本可以由我们热爱Python的数据工程师编写和维护。</li>
<li class="translated">Algolia前端SDK是有据可查的。我向我们的一些前端开发人员展示了我的应用程序，在检查了代码之后，他们对自己使用InstantSearch.js感到非常兴奋。</li>
<li class="translated">由于Algolia是云托管的，这让我们的基础设施团队很高兴，因为没有必要在我们的环境中引入另一个系统。它可以自动扩展，并且提供的SLA符合我们的要求。</li>
<li class="translated">我们根本不需要修改我们的应用程序后端，这为我们节省了大量的时间和成本。</li>
</ul>
<p class="translated">基于这些发现，我肯定会向我的团队推荐我们在生产中使用Algolia。</p>
</div></div>    
</body>
</html>