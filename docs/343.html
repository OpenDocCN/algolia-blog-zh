<html>
<head>
<title>How Algolia created its Netlify build plugin - Algolia Blog | Algolia Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Algolia如何创建其Netlify构建插件</h1>
<blockquote>原文：<a href="https://www.algolia.com/blog/engineering/how-algolia-created-its-netlify-build-plugin/#0001-01-01">https://www.algolia.com/blog/engineering/how-algolia-created-its-netlify-build-plugin/#0001-01-01</a></blockquote><div><div class="css-t54cg4"><p class="translated"><span>我们最近发布了</span> <a href="https://www.globenewswire.com/news-release/2020/10/06/2104357/0/en/Algolia-Streamlines-Search-for-Jamstack-Powered-Websites-With-New-Plugin-for-Netlify.html" target="_blank" rel="noopener noreferrer"> <span>的Algolia Netlify插件</span> </a> <span>。你可以</span> <a href="https://www.netlify.com/blog/2020/10/07/tech-partners-create-custom-build-plugins-to-reach-developers-in-their-workflow/" target="_blank" rel="noopener noreferrer"> <span>阅读更多关于</span></a><span/><a href="https://www.youtube.com/watch?v=zbdfqfn1yiM" target="_blank" rel="noopener noreferrer"><span>的插件，观看</span> </a> <span>的介绍，或者马上获得</span> <a href="https://app.netlify.com/plugins/@algolia/netlify-plugin-crawler/install" target="_blank" rel="noopener noreferrer"> <span>的入门</span> </a> <span>。Algolia是一个灵活的搜索和导航平台，能够提供尖端的网络、应用程序和电子商务体验。这篇文章深入探讨了我们是如何构建它的，并为Netlify构建插件的其他创建者提供了一些见解。</span></p>
<p class="translated"><i> <span>了解如何使用Netlify构建插件</span> </i>  <i> <span>或</span> </i> <a href="https://docs.netlify.com/configure-builds/build-plugins/create-plugins/" target="_blank" rel="noopener noreferrer"> <i> <span>创建自己的</span></i></a><i><span>Netlify构建插件。</span>T49】</i></p>
<h2 class="translated"><a id="what-is-the-algolia-netlify-plugin" class="anchor" href="#what-is-the-algolia-netlify-plugin" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>什么是Algolia Netlify插件？</span></h2>
<p class="translated">Algolia Netlify插件是一种在你的Netlify网站上添加搜索的简单方法，让你只用几行代码就能添加Algolia搜索体验。一个好处是，设置完成后，插件提供的搜索结果会随着你的网站内容不断进化，每次你发布新版本的网站都会自动刷新，免去了维护搜索索引的麻烦。每当你发布一个新版本的网站时，这个插件就会触发一个爬虫来浏览和提取你网站的内容，并把它推送到Algolia索引中。</p>
<figure id="attachment_11342" aria-describedby="caption-attachment-11342" class="wp-caption aligncenter"><img loading="lazy" class="wp-image-11342 size-large" src="../Images/04dd2a97941e32eefbded2d00d61879e.png" alt="" srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_flow-638x400.jpg 638w, https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_flow-284x178.jpg 284w, https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_flow-768x481.jpg 768w" sizes="(max-width: 638px) 100vw, 638px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_flow-638x400.jpg"/><figcaption id="caption-attachment-11342" class="wp-caption-text">Diagram representation of the Algolia Netlify plugin flow.</figcaption></figure>
<h2 class="translated"><a id="how-we-built-it" class="anchor" href="#how-we-built-it" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>我们如何建造它</span></h2>
<p class="translated"><span>该插件的目标是通过利用以下现有的Algolia产品，提供易于设置的网络搜索体验:</span></p>
<ul>
<li aria-level="1" class="translated"><span>搜索API，实际搜索引擎</span></li>
<li aria-level="1" class="translated"><span>Crawler是一个爬行网站的附加软件，它将网页内容提取为结构化数据，并将其推入Algolia </span></li>
<li aria-level="1" class="translated"><span>autocomplete . js UI库</span></li>
</ul>
<p class="translated"><span>我们的主要目标是创建一个Netlify插件，在每次部署后，触发爬虫浏览网站并建立一个现成的Algolia索引。这听起来很简单，但是你会发现，为了提供出色的用户体验，有很多东西需要整合在一起。在接下来的部分中，我们将详细介绍每个现有的和新的组件所需要的工作。</span></p>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a></h3>
<h3 class="translated"><a id="algolia-account-and-authentication" class="anchor" href="#algolia-account-and-authentication" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>阿果账号和认证</span></h3>
<p class="translated"><span>要使用Algolia，首要要求是要有账号。然后，要访问Algolia Crawler界面，您需要专门的权限，通常手动激活。为了提供流畅的体验，并避免用户复制/粘贴令牌或请求访问，我们添加了一个新的登录选项:“使用Netlify登录”，它与</span> <a href="https://docs.netlify.com/api/get-started/#authentication" target="_blank" rel="noopener noreferrer"> <span> Netlify的OAuth2 API </span> </a> <span>集成在一起。当您使用您的Netlify帐户登录Algolia时，我们会自动创建一个Algolia帐户(如果您已经有一个帐户，则链接它)，并授予对Algolia爬虫界面的访问权限。我们还检索并存储一个Netlify令牌，我们稍后会用到它。</span></p>
<figure id="attachment_11267" aria-describedby="caption-attachment-11267" class="wp-caption aligncenter"><img loading="lazy" class="size-full wp-image-11267" src="../Images/c1e5ba195aca069623759ae1b9d284ea.png" alt="Screenshot of the Algolia login options, with a new Netlify login button." srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/image1-2.png 458w, https://blog-api.algolia.com/wp-content/uploads/2021/01/image1-2-320x128.png 320w" sizes="(max-width: 458px) 100vw, 458px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/image1-2.png"/><figcaption id="caption-attachment-11267" class="wp-caption-text">Screenshot of the Algolia login options, with a new Netlify login button.</figcaption></figure>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a></h3>
<h3 class="translated"><a id="crawler-ui-updates" class="anchor" href="#crawler-ui-updates" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>爬虫UI更新</span></h3>
<p class="translated">我们需要为用户提供一个报告界面，让他们知道爬虫在他们网站上的行为。为了让这种体验更流畅，我们给Netlify用户提供了对现有爬虫界面的访问，并做了一些调整。</p>
<p class="translated"><span>为了管理可用的工具，我们引入了一个新的“Netlify”角色，该角色提供对一些高级配置屏幕和我们提供给普通客户的大多数高级调试工具的访问。</span></p>
<p class="translated"><img loading="lazy" class="aligncenter wp-image-11345 size-large" src="../Images/5a394b69c136725e9b9e0bc24dbe3f54.png" alt="Screenshot of the Algolia Crawler monitoring interface." srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/crawler_interface-720x356.png 720w, https://blog-api.algolia.com/wp-content/uploads/2021/01/crawler_interface-320x158.png 320w, https://blog-api.algolia.com/wp-content/uploads/2021/01/crawler_interface-768x380.png 768w" sizes="(max-width: 640px) 100vw, 640px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/crawler_interface-720x356.png"/></p>
<p class="translated">这个Netlify角色还授予对一些额外页面的访问权限，这些页面是专门为插件开发的，只对Netlify用户可用。这些页面允许管理网络站点上的插件安装。它们使用我们在身份验证期间检索的OAuth令牌与Netlify API对话，列出用户的站点，并在插件安装在其中一个站点上时将必要的API凭证推送给Netlify。</p>
<p class="translated"><img loading="lazy" class="aligncenter wp-image-11346 size-large" src="../Images/dbaf0d8b6b219e8e2f5ec600457d47b3.png" alt="Screenshot of the plugin configuration interface." srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_management-720x388.png 720w, https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_management-320x172.png 320w, https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_management-768x414.png 768w" sizes="(max-width: 640px) 100vw, 640px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/plugin_management-720x388.png"/></p>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>T7】</a></h3>
<h3 class="translated"><a id="api-update" class="anchor" href="#api-update" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span> API更新</span></h3>
<p class="translated"><span>我们已经有了一个公共API来以编程方式管理爬虫。我们需要的是一个额外的端点，当一个网站被部署时，专门用于网络任务:</span></p>
<ul>
<li aria-level="1" class="translated"><span>如果不存在爬虫，则创建一个爬虫(我们为每个分支创建一个爬虫)</span></li>
<li aria-level="1" class="translated"><span>根据“netlify . toml”</span>中设置的选项更新设置</li>
<li aria-level="1" class="translated"><span>运行实际爬行</span></li>
</ul>
<p class="translated">当在Netlify上触发构建时，调用此端点。</p>
<p class="translated">多亏了OAuth令牌，当你从我们的Crawler接口安装插件时，它受到自动添加到你的Netlify站点的环境变量中的凭证的保护。</p>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>T5】</a></h3>
<h3 class="translated"><span>数据提取</span></h3>
<p class="translated"><span> Algolia Crawler最初被命名为Algolia Custom Crawler，因为数据提取可以完全定制。事实上，我们的爬虫使付费用户能够完全控制使用“recordExtractor”函数提取的数据，这是一个您必须自己实现的JavaScript函数。它通过一个<a href="https://cheerio.js.org/" target="_blank" rel="noopener noreferrer"> Cheerio </a>实例公开每个被访问页面的DOM，您有责任提取数据并返回结构化记录:</span></p>
<pre><code>recordExtractor: ({ $, url }) =&gt; {&#13;
  const hierarchy = $('.breadcrumb &gt; ul &amp;gt; li &gt; a')&#13;
    .map((i, el) =&gt; $(el).text())&#13;
    .get()&#13;
  const content = $('#main-content .section-main p')&#13;
    .map(function() { return $(this).text() })&#13;
    .get()&#13;
    .join(' ');&#13;
  return [{&#13;
    url,&#13;
    hierarchy,&#13;
    content,&#13;
  }];&#13;
}</code></pre>
<p class="translated"><span>这是一个产生卓越结果的高级功能，因为我们的每个客户都可以创建一个为其网站量身定制的功能，并准确提取所需的数据。</span></p>
<p class="translated"><span>对于Netlify插件，我们希望提供一个通用的解决方案来处理大多数网站，并且不需要任何代码或高级配置。面临的挑战是每个网站都非常不同，即使HTML现在提供了许多</span> <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element#Content_sectioning" target="_blank" rel="noopener noreferrer"> <span>标签来构建页面的内容</span> </a> <span>，大多数网站仍然主要依靠传统的<code>divs</code>。这使得提取实际内容和去除其余内容(菜单、页脚等)变得更加困难。</span></p>
<p class="translated">没有什么神奇的方法可以做到这一点。解决方案是从一个简单的提取功能开始，尝试从每个页面的多个位置提取内容，并在真实的网页上进行测试。从那里，我们可以识别共同的模式并进行迭代。为了确保提取过程中的每个修改都是有益的，我们花时间制作了各种网页的快照(当然是托管在Netlify上的！)，对它们运行提取器并创建提取快照。这样，每当我们调整提取算法时，我们就能立即看到它破坏或改进了什么:</p>
<p class="translated"><img loading="lazy" class="aligncenter wp-image-11349 size-large" src="../Images/f0e27f183b33b0563f53772811432baf.png" alt="Screenshot illustrating the regression tests related to the data extraction." srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/regression_tests_extraction-720x255.png 720w, https://blog-api.algolia.com/wp-content/uploads/2021/01/regression_tests_extraction-320x113.png 320w, https://blog-api.algolia.com/wp-content/uploads/2021/01/regression_tests_extraction-768x272.png 768w, https://blog-api.algolia.com/wp-content/uploads/2021/01/regression_tests_extraction.png 1900w" sizes="(max-width: 640px) 100vw, 640px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/regression_tests_extraction-720x255.png"/></p>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>T5】</a></h3>
<h3 class="translated"><a id="front-end-bundle" class="anchor" href="#front-end-bundle" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>前端捆绑</span></h3>
<p class="translated"><span>卓越的搜索体验中的一个重要部分是显示搜索结果的前端，它总是由网站维护者来构建和集成。在Algolia，我们有许多可用的库来帮助我们的用户完成这个过程，但是有了Netlify插件，我们希望这个步骤更加容易。既然我们知道提取的记录的结构，我们决定基于</span><a href="https://github.com/algolia/autocomplete.js/" target="_blank" rel="noopener noreferrer"><span>autocomplete . js</span></a><span>构建一个预打包的UI，这是一个非常轻量级的自动完成库，我们在内部开发，多年来一直使用它来构建</span><a href="https://docsearch.algolia.com/"><span>DocSearch</span></a><span>UI。</span></p>
<p class="translated">结果是，通过复制/粘贴你的网站代码中的那几行。。。</p>
<pre><code>&lt;script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@algolia/algoliasearch-netlify-frontend@1/dist/algoliasearchNetlify.js"&gt;&lt;/script&gt;&#13;
&lt;script type="text/javascript"&gt;&#13;
  algoliasearchNetlify({&#13;
    appId: '&lt;YOUR_ALGOLIA_APP_ID',&#13;
    apiKey: '',&#13;
    siteId: '',&#13;
    branch: 'master',&#13;
    selector: 'div#search',&#13;
  });&#13;
&lt;/script&gt;</code></pre>
<p class="translated"><span>。。。您最终会看到下面的用户界面。</span></p>
<p class="translated">当然，为了使设计完美地适应您的网站，我们仍然建议构建您自己的网站，但我们相信这种预打包的UI是一种在几分钟内开始的好方法。当然，我们公开了一个主题属性，让您调整颜色。</p>
<figure id="attachment_11344" aria-describedby="caption-attachment-11344" class="wp-caption aligncenter"><img loading="lazy" class="wp-image-11344 size-large" src="../Images/8e609d7add9f00dcfc02056ed6e55094.png" alt="Screenshot of the front-end bundle in action." srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/autocomplete_ui-629x400.png 629w, https://blog-api.algolia.com/wp-content/uploads/2021/01/autocomplete_ui-280x178.png 280w, https://blog-api.algolia.com/wp-content/uploads/2021/01/autocomplete_ui-768x488.png 768w, https://blog-api.algolia.com/wp-content/uploads/2021/01/autocomplete_ui.png 1240w" sizes="(max-width: 629px) 100vw, 629px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/autocomplete_ui-629x400.png"/><figcaption id="caption-attachment-11344" class="wp-caption-text">Screenshot of the front-end bundle in action.</figcaption></figure>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a></h3>
<h3 class="translated"><a id="the-actual-plugin" class="anchor" href="#the-actual-plugin" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>实际插件</span></h3>
<p class="translated">Algolia Netlify插件的最后一部分是…实际的插件本身！</p>
<p class="translated">创建一个网络插件是一种流畅的体验。Netlify的API和工具非常完整且易于使用，我们可以看到它是为Algolia等API服务而设计的。我们插件的核心可以总结为下面的API调用:</p>
<pre><code>function onSuccess(params) {&#13;
  require('https').request('https://crawler.algolia.com/api/1/netlify/crawl', { method: 'POST' }).end();&#13;
}</code></pre>
<p class="translated"><span>但是当我们实现了初始版本后，<code>onSuccess</code> <a href="https://docs.netlify.com/configure-builds/build-plugins/create-plugins/#plug-in-to-build-events" target="_blank" rel="noopener noreferrer">构建事件</a> </span> <span>就不可用了。构建触发的最后一个事件是<code>onPostBuild</code>，它在构建之后、站点发布之前触发。由于我们的插件是为了抓取现场网站，我们需要一个后来的事件。我们联系了Netlify团队，他们非常积极，很快,<code>onSuccess</code>事件对我们的插件可用。正是在这个阶段，插件调用我们的爬虫API来触发爬行。</span></p>
<p class="translated">注意:Netlify团队目前正在开发<code>onSuccess</code>事件，将来该事件触发的时间可能会改变。关注围绕该主题的产品更新！</p>
<p class="translated"><img loading="lazy" class="aligncenter wp-image-11348 size-large" src="../Images/e43c816ba8b01f7ca32778ae7b5e4df9.png" alt="Screenshot of the Netlify build logs, focused on the logs generated by the Algolia Netlify plugin." srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/netlify_logs-656x400.png 656w, https://blog-api.algolia.com/wp-content/uploads/2021/01/netlify_logs-292x178.png 292w, https://blog-api.algolia.com/wp-content/uploads/2021/01/netlify_logs-768x468.png 768w, https://blog-api.algolia.com/wp-content/uploads/2021/01/netlify_logs.png 1486w" sizes="(max-width: 640px) 100vw, 640px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/netlify_logs-656x400.png"/></p>
<p class="translated"><span>由于完整的抓取需要时间(取决于每个网站的页面数量)，该插件不会阻止构建过程，并在后台继续。</span></p>
<h3 class="translated"><a id="development-and-release" class="anchor" href="#development-and-release" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>开发发布</span></h3>
<p class="translated"><span>我们决定将插件代码和UI代码放在同一个库中。我们还添加了一个包含静态测试网站的目录。</span></p>
<figure id="attachment_11343" aria-describedby="caption-attachment-11343" class="wp-caption aligncenter"><img loading="lazy" class="wp-image-11343 size-large" src="../Images/e3d86aa6cc2926364cc978f7f67ee372.png" alt="Screenshot illustrating our code repository structure, showing 3 directories: &quot;frontend&quot;, &quot;plugin&quot; and &quot;public&quot;" srcset="https://blog-api.algolia.com/wp-content/uploads/2021/01/repo_organisation-720x125.png 720w, https://blog-api.algolia.com/wp-content/uploads/2021/01/repo_organisation-320x56.png 320w, https://blog-api.algolia.com/wp-content/uploads/2021/01/repo_organisation-768x134.png 768w, https://blog-api.algolia.com/wp-content/uploads/2021/01/repo_organisation.png 1184w" sizes="(max-width: 640px) 100vw, 640px" data-original-src="https://blog-api.algolia.com/wp-content/uploads/2021/01/repo_organisation-720x125.png"/><figcaption id="caption-attachment-11343" class="wp-caption-text">Screenshot illustrating our code repository structure, showing 3 directories: “frontend”, “plugin” and “public”</figcaption></figure>
<p class="translated"><span>这使我们能够集中开发和发布脚本。由于</span><a href="https://docs.netlify.com/cli/get-started/" target="_blank" rel="noopener noreferrer"><span>Netlify CLI</span></a><span>允许在本地模拟一个Netlify构建，我们能够设置一个单独的</span> <span> yarn dev </span> <span>命令，它:</span></p>
<ul>
<li class="translated"><span>在前端运行开发版本</span></li>
<li class="translated"><span>服务于一个测试网站，该网站使用开发前端</span></li>
<li class="translated"><span>触发运行插件本地版本的网络构建，并可以调用本地爬虫</span></li>
</ul>
<p class="translated"><span>发布类似:Netlify插件通过npm的公共注册表发布。前端分布有</span><a href="https://www.jsdelivr.com/" target="_blank" rel="noopener noreferrer"><span>jsDeliver</span></a><span>，同样依托npm的公共注册表。至于我们的</span> <a href="https://algoliasearch-netlify.netlify.app/" target="_blank" rel="noopener noreferrer"> <span>测试网站</span> </a> <span>，当然是托管在Netlify上。这意味着每次我们在GitHub上发布所有最新的变化，测试网站都会更新。发布过程可以总结为3个步骤:</span></p>
<ul>
<li aria-level="1" class="translated"><span>运行我们的</span> <a href="https://github.com/algolia/algoliasearch-netlify/blob/master/scripts/release.sh" target="_blank" rel="noopener noreferrer"> <span>发布脚本</span> </a> <span>，构建Netlify插件和前端，发布到npm上；</span></li>
<li aria-level="1" class="translated"><span>推送GitHub上的所有变更；</span></li>
</ul>
<p class="translated"><a href="https://github.com/netlify/plugins/blob/master/docs/CONTRIBUTING.md#update-a-plugin" target="_blank" rel="noopener noreferrer"> <span>提交新版本插件</span> </a> <span>供Netlify团队验证。</span></p>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a></h3>
<h3 class="translated"><a id="recent-changes-and-enhancements" class="anchor" href="#recent-changes-and-enhancements" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>最近的变化和增强</span></h3>
<p class="translated">如果你在10月份试用过该插件的第一个测试版，我们已经做了很多改进和润色！因此，我们想以v1中包含的所有变化的总结来结束本文。试试吧！</p>
<ul>
<li aria-level="1" class="translated"><span>执行页面JavaScript的新选项；</span></li>
<li aria-level="1" class="translated"><span>📑提取模板，每页提取多条记录，与DocSearch UI兼容；</span></li>
<li aria-level="1" class="translated"><span> ✨我们的预建UI现在使用</span><a href="https://autocomplete.algolia.com/" target="_blank" rel="noopener noreferrer"><span>autocomplete . js v1</span></a><span>，完全重写了我们的自动完成库；</span></li>
<li aria-level="1" class="translated"><span> ⚙️支持跨分支机构的自定义Algolia指数设置:您对主指数设置所做的所有更改都将传播到新的分支机构；</span></li>
<li aria-level="1" class="translated"><span>💻建立一个自定义域的可能性。</span></li>
</ul>
<h3 class="translated"><a id="" class="anchor" href="#" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>T4】</a></h3>
<h3 class="translated"><a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"> <svg aria-hidden="true" class="octicon octicon-link" version="1.1" viewbox="0 0 16 16"> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/> </svg> </a> <span>结论</span></h3>
<p class="translated">对于Algolia来说，在Netlify团队的帮助下构建插件是一次值得的经历；我们会推荐给其他SaaS公司。这项工作很有趣，因为涉及到许多不同的组件，Netlify工具使用起来很愉快，他们的团队反应很快，一路上都在帮助我们。</p>
<p class="translated"><span>现在退一步讲，我们真的认为Netlify构建插件非常适合集成像Algolia这样的服务。</span></p>
<p class="translated"><span>最后对大家都有好处的是:</span></p>
<ul>
<li aria-level="1" class="translated"><span> Netlify可以为其用户提供一个免费且易于设置的搜索功能</span></li>
<li aria-level="1" class="translated"><span> Algolia可以向</span> <a href="https://www.netlify.com/blog/2020/08/03/celebrating-1-million-developers-whats-next-for-netlify-and-the-jamstack/" target="_blank" rel="noopener noreferrer"> <span> 1M网络开发者</span> </a>展示其产品</li>
<li aria-level="1" class="translated">Netlify用户还有另一个插件可以用来建立他们的Jamstack站点</li>
</ul>
<p class="translated">基于所有这些原因，我们鼓励其他SaaS公司也开发他们自己的Netlify插件！</p>
<p class="translated"><span>如果你有一个虚拟网站，试试</span><a href="https://github.com/algolia/algoliasearch-netlify/" target="_blank" rel="noopener noreferrer"><span/></a><span>！</span></p>
</div></div>    
</body>
</html>